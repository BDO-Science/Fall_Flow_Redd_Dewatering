<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.7.32">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">


<title>real-time-estimates-prelim-automated-v7</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
  vertical-align: middle;
}
</style>


<script src="real-time-estimates-prelim-automated-v7_files/libs/clipboard/clipboard.min.js"></script>
<script src="real-time-estimates-prelim-automated-v7_files/libs/quarto-html/quarto.js" type="module"></script>
<script src="real-time-estimates-prelim-automated-v7_files/libs/quarto-html/tabsets/tabsets.js" type="module"></script>
<script src="real-time-estimates-prelim-automated-v7_files/libs/quarto-html/popper.min.js"></script>
<script src="real-time-estimates-prelim-automated-v7_files/libs/quarto-html/tippy.umd.min.js"></script>
<script src="real-time-estimates-prelim-automated-v7_files/libs/quarto-html/anchor.min.js"></script>
<link href="real-time-estimates-prelim-automated-v7_files/libs/quarto-html/tippy.css" rel="stylesheet">
<link href="real-time-estimates-prelim-automated-v7_files/libs/quarto-html/quarto-syntax-highlighting-37eea08aefeeee20ff55810ff984fec1.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="real-time-estimates-prelim-automated-v7_files/libs/bootstrap/bootstrap.min.js"></script>
<link href="real-time-estimates-prelim-automated-v7_files/libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="real-time-estimates-prelim-automated-v7_files/libs/bootstrap/bootstrap-f18df3632ac14ff77ac649842474db34.min.css" rel="stylesheet" append-hash="true" id="quarto-bootstrap" data-mode="light">


</head>

<body class="quarto-light">

<div id="quarto-content" class="page-columns page-rows-contents page-layout-article">
<div id="quarto-margin-sidebar" class="sidebar margin-sidebar">
  <nav id="TOC" role="doc-toc" class="toc-active">
    <h2 id="toc-title">Table of contents</h2>
   
  <ul>
  <li><a href="#preliminary-data-redd-dewatering-estimates-for-keswick-fall-flow-scenarios" id="toc-preliminary-data-redd-dewatering-estimates-for-keswick-fall-flow-scenarios" class="nav-link active" data-scroll-target="#preliminary-data-redd-dewatering-estimates-for-keswick-fall-flow-scenarios">PRELIMINARY DATA: Redd Dewatering Estimates for Keswick Fall Flow Scenarios</a>
  <ul class="collapse">
  <li><a href="#background" id="toc-background" class="nav-link" data-scroll-target="#background">Background</a></li>
  <li><a href="#winter-run-redd-counts" id="toc-winter-run-redd-counts" class="nav-link" data-scroll-target="#winter-run-redd-counts">Winter-run Redd Counts</a></li>
  <li><a href="#redd-dewatering-estimates" id="toc-redd-dewatering-estimates" class="nav-link" data-scroll-target="#redd-dewatering-estimates">Redd dewatering estimates</a></li>
  <li><a href="#carryover-effects-to-next-year-winter-run-brood" id="toc-carryover-effects-to-next-year-winter-run-brood" class="nav-link" data-scroll-target="#carryover-effects-to-next-year-winter-run-brood">Carryover Effects to Next Year Winter-run Brood</a></li>
  <li><a href="#preliminary-predicted-results" id="toc-preliminary-predicted-results" class="nav-link" data-scroll-target="#preliminary-predicted-results">Preliminary Predicted Results</a></li>
  <li><a href="#references" id="toc-references" class="nav-link" data-scroll-target="#references">References</a></li>
  </ul></li>
  </ul>
<div class="quarto-alternate-formats"><h2>Other Formats</h2><ul><li><a href="real-time-estimates-prelim-automated-v7.pdf"><i class="bi bi-file-pdf"></i>PDF</a></li><li><a href="real-time-estimates-prelim-automated-v7.docx"><i class="bi bi-file-word"></i>MS Word</a></li></ul></div></nav>
</div>
<main class="content" id="quarto-document-content">




<section id="preliminary-data-redd-dewatering-estimates-for-keswick-fall-flow-scenarios" class="level2">
<h2 class="anchored" data-anchor-id="preliminary-data-redd-dewatering-estimates-for-keswick-fall-flow-scenarios">PRELIMINARY DATA: Redd Dewatering Estimates for Keswick Fall Flow Scenarios</h2>
<p><em>BDO Science Division</em></p>
<p><em>August 26, 2025</em></p>
<section id="background" class="level3">
<h3 class="anchored" data-anchor-id="background">Background</h3>
<p>This script constructs real-time winter-run redd dewatering estimates based on most recent data available from CDFW (as of August 21, 2025) for winter-run data and using a redd dewatering estimate tool from USFWS (2006; see citation). Data are also available in the 2025 Winter-run Data file.xls online at <a href="https://www.calfish.org/ProgramsData/ConservationandManagement/CentralValleyMonitoring/CDFWUpperSacRiverBasinSalmonidMonitoring.aspx">calfish.org</a>.</p>
<p>This document is also now available on <a href="https://www.cbr.washington.edu/sacramento/workgroups/usst.html#redd_dewater">SacPAS</a>. However, data on the SacPAS webpage may not immediately reflect data in the document as updates to the webpage with newest flow and redd data may be pending.</p>
<p>Please note that all data are preliminary until data collection is finalized. Likewise, there are uncertainties with forecasts which may lead to changes in proposed operations.</p>
</section>
<section id="winter-run-redd-counts" class="level3">
<h3 class="anchored" data-anchor-id="winter-run-redd-counts">Winter-run Redd Counts</h3>
<p>As of August 20, 2025, the unexpanded redd count is <strong>2675</strong> Winter-run redds. It is important to note that until data collection is completed for the year these are the <strong>minimum</strong> number of possible redds. The Winter-run number will always expand upon final analysis but gives an in-season guard rail of the minimum number of redds this year.</p>
<p>Given that the number of Winter-run redds is always larger than the early season carcass counts, an expansion number based on historic data is multiplied by the carcass count to estimate the total number of redds for the season before the end of the season’s final estimate is developed and the final redd count is known. Average 2005-2022 expansion was 2.04 * the total redd count, but we illustrate several different expansion scenarios in the table below.</p>
<div class="cell" data-tbl-cap="Estimated total number of Winter-run redds with varying expansion factors and resulting number of redds that represent 1 percent of the population.  An expansion factor of 1 approximates the lowest expansion factor of 1.25 observed in 2010, an expansion of 3.5 approximates the highest expansion factor of 3.36 in 2017, and an expansion of 2.0 approximates the average expansion factor of 2.04 over a 20 year period">
<table class="caption-top table table-sm table-striped small">
<caption>Estimated total number of Winter-run redds with varying expansion factors and resulting number of redds that represent 1 percent of the population. An expansion factor of 1 approximates the lowest expansion factor of 1.25 observed in 2010, an expansion of 3.5 approximates the highest expansion factor of 3.36 in 2017, and an expansion of 2.0 approximates the average expansion factor of 2.04 over a 20 year period</caption>
<thead>
<tr class="header">
<th style="text-align: left;">Expansion Factor</th>
<th style="text-align: right;">Total Redds</th>
<th style="text-align: right;">Dewatering Threshold (1%)</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: left;">1.0</td>
<td style="text-align: right;">2675</td>
<td style="text-align: right;">27</td>
</tr>
<tr class="even">
<td style="text-align: left;">1.5</td>
<td style="text-align: right;">4012</td>
<td style="text-align: right;">40</td>
</tr>
<tr class="odd">
<td style="text-align: left;">2.0</td>
<td style="text-align: right;">5350</td>
<td style="text-align: right;">54</td>
</tr>
<tr class="even">
<td style="text-align: left;">2.5</td>
<td style="text-align: right;">6688</td>
<td style="text-align: right;">67</td>
</tr>
<tr class="odd">
<td style="text-align: left;">3.0</td>
<td style="text-align: right;">8025</td>
<td style="text-align: right;">80</td>
</tr>
<tr class="even">
<td style="text-align: left;">3.5</td>
<td style="text-align: right;">9362</td>
<td style="text-align: right;">94</td>
</tr>
</tbody>
</table>
</div>
</section>
<section id="redd-dewatering-estimates" class="level3">
<h3 class="anchored" data-anchor-id="redd-dewatering-estimates">Redd dewatering estimates</h3>
<p>A total of <strong>213</strong> redds are or have been monitored this season. As of August 21, 2025, <strong>0</strong> Winter-run redds have <strong>emerged</strong> and <strong>11</strong> have been <strong>dewatered</strong>. This leaves <strong>202</strong> shallow water redds of concern.</p>
<p>There is no real time data on fall-run redd counts. Estimates are predicted based on estimated dewatering percentages from USFWS (2006) and spring-run and fall-run spawn timing based on fresh female carcasses encountered from 2014 through 2023. Emergence timing were predicted from water temperatures below Keswick individually for each year and dewatering was estimated for each scenario for each year to capture annual variance in spawn timing. Fall-run dewatering estimates range from <strong>6.4</strong> to <strong>25.6%</strong> (see detailed data in table below). Note that fall-run dewatering estimates are likely overestimated using the dewatering percentages from USFWS (2006), and likely do not reflect actual dewatering percentages and should only be used for comparative purposes between scenarios. A comparative analysis between field and modeled dewatering percentages by Gosselin and Beer (2024) can be found <a href="https://www.cbr.washington.edu/sacramento/fishmodel/Note_on_Redd_Dewatering_Observed_v_Predicted.pdf">here</a>.</p>
<div class="cell" data-tbl-cap="Estimated fall-run redd dewatering for each scenario by spawning year to reflect variation in spawn timing">
<table class="caption-top table table-sm table-striped small">
<caption>Estimated fall-run redd dewatering for each scenario by spawning year to reflect variation in spawn timing</caption>
<colgroup>
<col style="width: 14%">
<col style="width: 8%">
<col style="width: 8%">
<col style="width: 8%">
<col style="width: 8%">
<col style="width: 8%">
<col style="width: 8%">
<col style="width: 8%">
<col style="width: 8%">
<col style="width: 8%">
<col style="width: 8%">
</colgroup>
<thead>
<tr class="header">
<th style="text-align: center;">Scenario</th>
<th style="text-align: center;">2014</th>
<th style="text-align: center;">2015</th>
<th style="text-align: center;">2016</th>
<th style="text-align: center;">2017</th>
<th style="text-align: center;">2018</th>
<th style="text-align: center;">2019</th>
<th style="text-align: center;">2020</th>
<th style="text-align: center;">2021</th>
<th style="text-align: center;">2022</th>
<th style="text-align: center;">2023</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: center;">A4</td>
<td style="text-align: center;">14.7</td>
<td style="text-align: center;">13.8</td>
<td style="text-align: center;">8.8</td>
<td style="text-align: center;">8.4</td>
<td style="text-align: center;">12.7</td>
<td style="text-align: center;">11.9</td>
<td style="text-align: center;">12.7</td>
<td style="text-align: center;">15.8</td>
<td style="text-align: center;">14.0</td>
<td style="text-align: center;">8.1</td>
</tr>
<tr class="even">
<td style="text-align: center;">B4</td>
<td style="text-align: center;">10.4</td>
<td style="text-align: center;">10.1</td>
<td style="text-align: center;">6.7</td>
<td style="text-align: center;">6.6</td>
<td style="text-align: center;">9.4</td>
<td style="text-align: center;">9.1</td>
<td style="text-align: center;">9.4</td>
<td style="text-align: center;">11.7</td>
<td style="text-align: center;">11.4</td>
<td style="text-align: center;">6.4</td>
</tr>
<tr class="odd">
<td style="text-align: center;">C2</td>
<td style="text-align: center;">22.4</td>
<td style="text-align: center;">21.0</td>
<td style="text-align: center;">14.8</td>
<td style="text-align: center;">16.8</td>
<td style="text-align: center;">22.9</td>
<td style="text-align: center;">19.5</td>
<td style="text-align: center;">18.7</td>
<td style="text-align: center;">25.6</td>
<td style="text-align: center;">23.4</td>
<td style="text-align: center;">15.9</td>
</tr>
<tr class="even">
<td style="text-align: center;">C3</td>
<td style="text-align: center;">15.7</td>
<td style="text-align: center;">14.5</td>
<td style="text-align: center;">9.9</td>
<td style="text-align: center;">10.8</td>
<td style="text-align: center;">15.6</td>
<td style="text-align: center;">13.7</td>
<td style="text-align: center;">13.2</td>
<td style="text-align: center;">17.8</td>
<td style="text-align: center;">15.9</td>
<td style="text-align: center;">10.4</td>
</tr>
</tbody>
</table>
</div>
</section>
<section id="carryover-effects-to-next-year-winter-run-brood" class="level3">
<h3 class="anchored" data-anchor-id="carryover-effects-to-next-year-winter-run-brood">Carryover Effects to Next Year Winter-run Brood</h3>
<p>An analysis on the relationship between winter-run chinook salmon temperature dependent mortality relationship and Shasta Reservoir end-of-year storage suggests a threshold of 2,200 TAF end of September Shasta Storage to assess the impacts of TDM impacts on next year’s cohort. Next year’s cohort is expected to experience minimal TDM impacts when end of September Shasta Storage is greater than this threshold, while values lower than 2,200 TAF are correlated with potentially more negative TDM impacts. As of August, End of September Shasta Storage is expected to be approximately <strong>2.6</strong>. All proposed scenarios are anticipated to have EOS storage greater than the 2,200 TAF threshold and therefore would not be expected to contribute to TDM impacts to winter-run chinook salmon in the subsequent year. Scenarios focused on avoiding dewatering of winter-run redds have higher releases through early November which is not factored into this performance indicator.</p>
</section>
<section id="preliminary-predicted-results" class="level3">
<h3 class="anchored" data-anchor-id="preliminary-predicted-results">Preliminary Predicted Results</h3>
<p>Below are summarized results of scenarios as they relate to total volume, winter-run redd dewatering, and fall-run redd dewatering by scenario. Note that winter-run redd dewatering is predicted and based on estimated flow in which a redd may be dewatered prior to emergence. Fall-run redd dewatering is averaged over multiple years of spawning data.</p>
<div class="cell" data-tbl-cap="Summary of water volume for each scenario. After August 1 in each year each scenario uses actual flow-to-date as of most current report and proposed flows for the remainder of the incubation period. See scenarios description table for further detailed explanation of scenarios.">
<table class="caption-top table table-sm table-striped small">
<caption>Summary of water volume for each scenario. After August 1 in each year each scenario uses actual flow-to-date as of most current report and proposed flows for the remainder of the incubation period. See scenarios description table for further detailed explanation of scenarios.</caption>
<thead>
<tr class="header">
<th style="text-align: left;">Volume Measures</th>
<th style="text-align: center;">C2</th>
<th style="text-align: center;">A4</th>
<th style="text-align: center;">B4</th>
<th style="text-align: center;">C3</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: left;">Avg Sept Flow (cfs)</td>
<td style="text-align: center;">8750</td>
<td style="text-align: center;">8500</td>
<td style="text-align: center;">8500</td>
<td style="text-align: center;">8508</td>
</tr>
<tr class="even">
<td style="text-align: left;">Avg Oct Flow (cfs)</td>
<td style="text-align: center;">8750</td>
<td style="text-align: center;">7500</td>
<td style="text-align: center;">6500</td>
<td style="text-align: center;">8006</td>
</tr>
<tr class="odd">
<td style="text-align: left;">Sept-Feb Total Volume (TAF)</td>
<td style="text-align: center;">2094</td>
<td style="text-align: center;">1978</td>
<td style="text-align: center;">1917</td>
<td style="text-align: center;">2020</td>
</tr>
<tr class="even">
<td style="text-align: left;">Aug-Sept Total Volume (TAF)</td>
<td style="text-align: center;">1195</td>
<td style="text-align: center;">1177</td>
<td style="text-align: center;">1177</td>
<td style="text-align: center;">1176</td>
</tr>
</tbody>
</table>
</div>
<div class="cell" data-tbl-cap="Estimated number of dewatered winter-run redds with and without a 250 cfs buffer. Winter-run redd dewatering predictions include any confirmed dewatered redds in the count to actively reflect both observed and predicted dewatering. After August 1 in each year each scenario uses actual flow-to-date as of most current report and proposed flows for the remainder of the incubation period. See scenarios description table for further detailed explanation of scenarios.">
<table class="caption-top table table-sm table-striped small">
<caption>Estimated number of dewatered winter-run redds with and without a 250 cfs buffer. Winter-run redd dewatering predictions include any confirmed dewatered redds in the count to actively reflect both observed and predicted dewatering. After August 1 in each year each scenario uses actual flow-to-date as of most current report and proposed flows for the remainder of the incubation period. See scenarios description table for further detailed explanation of scenarios.</caption>
<thead>
<tr class="header">
<th style="text-align: left;">Dewatering Count Measures</th>
<th style="text-align: center;">C2</th>
<th style="text-align: center;">A4</th>
<th style="text-align: center;">B4</th>
<th style="text-align: center;">C3</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: left;">Winter-run Redds Dewatered</td>
<td style="text-align: center;">26</td>
<td style="text-align: center;">60</td>
<td style="text-align: center;">79</td>
<td style="text-align: center;">52</td>
</tr>
<tr class="even">
<td style="text-align: left;">Winter-run Redds Dewatered (250 cfs buffer)</td>
<td style="text-align: center;">32</td>
<td style="text-align: center;">73</td>
<td style="text-align: center;">112</td>
<td style="text-align: center;">64</td>
</tr>
</tbody>
</table>
</div>
<div class="cell" data-tbl-cap="Predicted percentage of winter-run and fall-run redds expected to be dewatered across scenarios, expansion factors, and flow buffers. Percentage of the population lost is based on most recent unexapanded count of Winter-run redds.  Fall-run dewatering percentage is average dewatering across years in table 2 for each scenario. After August 1 in each year each scenario uses actual flow-to-date as of most current report and proposed flows for the remainder of the incubation period. See scenarios description table for further detailed explanation of scenarios.">
<table class="caption-top table table-sm table-striped small">
<caption>Predicted percentage of winter-run and fall-run redds expected to be dewatered across scenarios, expansion factors, and flow buffers. Percentage of the population lost is based on most recent unexapanded count of Winter-run redds. Fall-run dewatering percentage is average dewatering across years in table 2 for each scenario. After August 1 in each year each scenario uses actual flow-to-date as of most current report and proposed flows for the remainder of the incubation period. See scenarios description table for further detailed explanation of scenarios.</caption>
<colgroup>
<col style="width: 65%">
<col style="width: 8%">
<col style="width: 8%">
<col style="width: 7%">
<col style="width: 8%">
</colgroup>
<thead>
<tr class="header">
<th style="text-align: left;">Dewatering % Measures</th>
<th style="text-align: center;">C2</th>
<th style="text-align: center;">A4</th>
<th style="text-align: center;">B4</th>
<th style="text-align: center;">C3</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: left;">Winter-run % Lost (expansion factor = 1)</td>
<td style="text-align: center;">1.0</td>
<td style="text-align: center;">2.2</td>
<td style="text-align: center;">3.0</td>
<td style="text-align: center;">1.9</td>
</tr>
<tr class="even">
<td style="text-align: left;">Winter-run % Lost (expansion factor = 2.04)</td>
<td style="text-align: center;">0.5</td>
<td style="text-align: center;">1.1</td>
<td style="text-align: center;">1.4</td>
<td style="text-align: center;">1.0</td>
</tr>
<tr class="odd">
<td style="text-align: left;">Winter-run % Lost (250 cfs buffer)</td>
<td style="text-align: center;">1.2</td>
<td style="text-align: center;">2.7</td>
<td style="text-align: center;">4.2</td>
<td style="text-align: center;">2.4</td>
</tr>
<tr class="even">
<td style="text-align: left;">Fall-run % Redds Dewatered</td>
<td style="text-align: center;">20.1</td>
<td style="text-align: center;">12.1</td>
<td style="text-align: center;">9.1</td>
<td style="text-align: center;">13.8</td>
</tr>
</tbody>
</table>
</div>
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="real-time-estimates-prelim-automated-v7_files/figure-html/redd_igure-1.png" class="img-fluid figure-img" width="864"></p>
<figcaption>Actual or estimated emergence dates of SRWC redds and actual or estimated dewatering flow for the September-October estimated redd emergence dates as compared to Keswick flow (in cfs) of proposed management alternatives. Points represent dewatered (De), emerged (Em), or remaining (Re) redds. Numbers inside of points indicate how many redds share that estimated emergence date and actual/estimated dewatering flow. Points that fall above/to the right of a flow alternative line are expected to be dewatered given that management alternative is followed. Points that fall below/to the left of/on a flow alternative line are not expected to be dewatered, given that management alternative is followed</figcaption>
</figure>
</div>
<div class="cell" data-tbl-cap="Description of scenarios being considered and compared by the Upper Sacramento Scheduling Team">
<table class="caption-top table table-sm table-striped small">
<caption>Description of scenarios being considered and compared by the Upper Sacramento Scheduling Team</caption>
<colgroup>
<col style="width: 3%">
<col style="width: 96%">
</colgroup>
<thead>
<tr class="header">
<th style="text-align: left;">Scenario</th>
<th style="text-align: left;">Description</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: left;">C2</td>
<td style="text-align: left;">Scenario focused on reducing winter-run redd dewatering developed on August 14, 2025.</td>
</tr>
<tr class="even">
<td style="text-align: left;">A4</td>
<td style="text-align: left;">Scenario using August 90% exceedance forecast developed on August 20, 2025. Adjusted for late August changes to Keswick releases. Does not follow ramping rate criteria.</td>
</tr>
<tr class="odd">
<td style="text-align: left;">B4</td>
<td style="text-align: left;">Scenario using August 50% Exceedance Forecast developed on August 20, 2025. Adjusted for late August changes to Keswick releases. Does not use ramping rate criteria.</td>
</tr>
<tr class="even">
<td style="text-align: left;">C3</td>
<td style="text-align: left;">Scenario focused on avoiding dewatering more than one percent of winter-run dewatered redds assuming a 2.5 expansion factor, balancing fall-run dewatering, and assuming low redd viability of late emerging winter-run redds due to redd superimposition. Developed on August 21, 2025.</td>
</tr>
</tbody>
</table>
</div>
</section>
<section id="references" class="level3">
<h3 class="anchored" data-anchor-id="references">References</h3>
<p>Gard, Mark. 2006. Relationships between flow fluctuations and redd dewatering and juvenile stranding for Chinook Salmon and Steelhead in the Sacramento River between Keswick Dam and Battle Creek. 94 pages.</p>
<p>Gosselin, J.L. and W.N. Beer. 2024. Sacramento River Winter-run Chinook Salmon Redd Dewatering: a Note on Comparing Observed and Predicted. Central Valley Prediction and Assessment of Salmon (SacPas; https://www.cbr.washington.edu/sacramento/). Columbia Basin Research, School of Aquatic and Fishery Sciences, University of Washington.</p>
</section>
</section>

</main>
<!-- /main column -->
<script id="quarto-html-after-body" type="application/javascript">
  window.document.addEventListener("DOMContentLoaded", function (event) {
    const icon = "";
    const anchorJS = new window.AnchorJS();
    anchorJS.options = {
      placement: 'right',
      icon: icon
    };
    anchorJS.add('.anchored');
    const isCodeAnnotation = (el) => {
      for (const clz of el.classList) {
        if (clz.startsWith('code-annotation-')) {                     
          return true;
        }
      }
      return false;
    }
    const onCopySuccess = function(e) {
      // button target
      const button = e.trigger;
      // don't keep focus
      button.blur();
      // flash "checked"
      button.classList.add('code-copy-button-checked');
      var currentTitle = button.getAttribute("title");
      button.setAttribute("title", "Copied!");
      let tooltip;
      if (window.bootstrap) {
        button.setAttribute("data-bs-toggle", "tooltip");
        button.setAttribute("data-bs-placement", "left");
        button.setAttribute("data-bs-title", "Copied!");
        tooltip = new bootstrap.Tooltip(button, 
          { trigger: "manual", 
            customClass: "code-copy-button-tooltip",
            offset: [0, -8]});
        tooltip.show();    
      }
      setTimeout(function() {
        if (tooltip) {
          tooltip.hide();
          button.removeAttribute("data-bs-title");
          button.removeAttribute("data-bs-toggle");
          button.removeAttribute("data-bs-placement");
        }
        button.setAttribute("title", currentTitle);
        button.classList.remove('code-copy-button-checked');
      }, 1000);
      // clear code selection
      e.clearSelection();
    }
    const getTextToCopy = function(trigger) {
        const codeEl = trigger.previousElementSibling.cloneNode(true);
        for (const childEl of codeEl.children) {
          if (isCodeAnnotation(childEl)) {
            childEl.remove();
          }
        }
        return codeEl.innerText;
    }
    const clipboard = new window.ClipboardJS('.code-copy-button:not([data-in-quarto-modal])', {
      text: getTextToCopy
    });
    clipboard.on('success', onCopySuccess);
    if (window.document.getElementById('quarto-embedded-source-code-modal')) {
      const clipboardModal = new window.ClipboardJS('.code-copy-button[data-in-quarto-modal]', {
        text: getTextToCopy,
        container: window.document.getElementById('quarto-embedded-source-code-modal')
      });
      clipboardModal.on('success', onCopySuccess);
    }
      var localhostRegex = new RegExp(/^(?:http|https):\/\/localhost\:?[0-9]*\//);
      var mailtoRegex = new RegExp(/^mailto:/);
        var filterRegex = new RegExp('/' + window.location.host + '/');
      var isInternal = (href) => {
          return filterRegex.test(href) || localhostRegex.test(href) || mailtoRegex.test(href);
      }
      // Inspect non-navigation links and adorn them if external
     var links = window.document.querySelectorAll('a[href]:not(.nav-link):not(.navbar-brand):not(.toc-action):not(.sidebar-link):not(.sidebar-item-toggle):not(.pagination-link):not(.no-external):not([aria-hidden]):not(.dropdown-item):not(.quarto-navigation-tool):not(.about-link)');
      for (var i=0; i<links.length; i++) {
        const link = links[i];
        if (!isInternal(link.href)) {
          // undo the damage that might have been done by quarto-nav.js in the case of
          // links that we want to consider external
          if (link.dataset.originalHref !== undefined) {
            link.href = link.dataset.originalHref;
          }
        }
      }
    function tippyHover(el, contentFn, onTriggerFn, onUntriggerFn) {
      const config = {
        allowHTML: true,
        maxWidth: 500,
        delay: 100,
        arrow: false,
        appendTo: function(el) {
            return el.parentElement;
        },
        interactive: true,
        interactiveBorder: 10,
        theme: 'quarto',
        placement: 'bottom-start',
      };
      if (contentFn) {
        config.content = contentFn;
      }
      if (onTriggerFn) {
        config.onTrigger = onTriggerFn;
      }
      if (onUntriggerFn) {
        config.onUntrigger = onUntriggerFn;
      }
      window.tippy(el, config); 
    }
    const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
    for (var i=0; i<noterefs.length; i++) {
      const ref = noterefs[i];
      tippyHover(ref, function() {
        // use id or data attribute instead here
        let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
        try { href = new URL(href).hash; } catch {}
        const id = href.replace(/^#\/?/, "");
        const note = window.document.getElementById(id);
        if (note) {
          return note.innerHTML;
        } else {
          return "";
        }
      });
    }
    const xrefs = window.document.querySelectorAll('a.quarto-xref');
    const processXRef = (id, note) => {
      // Strip column container classes
      const stripColumnClz = (el) => {
        el.classList.remove("page-full", "page-columns");
        if (el.children) {
          for (const child of el.children) {
            stripColumnClz(child);
          }
        }
      }
      stripColumnClz(note)
      if (id === null || id.startsWith('sec-')) {
        // Special case sections, only their first couple elements
        const container = document.createElement("div");
        if (note.children && note.children.length > 2) {
          container.appendChild(note.children[0].cloneNode(true));
          for (let i = 1; i < note.children.length; i++) {
            const child = note.children[i];
            if (child.tagName === "P" && child.innerText === "") {
              continue;
            } else {
              container.appendChild(child.cloneNode(true));
              break;
            }
          }
          if (window.Quarto?.typesetMath) {
            window.Quarto.typesetMath(container);
          }
          return container.innerHTML
        } else {
          if (window.Quarto?.typesetMath) {
            window.Quarto.typesetMath(note);
          }
          return note.innerHTML;
        }
      } else {
        // Remove any anchor links if they are present
        const anchorLink = note.querySelector('a.anchorjs-link');
        if (anchorLink) {
          anchorLink.remove();
        }
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(note);
        }
        if (note.classList.contains("callout")) {
          return note.outerHTML;
        } else {
          return note.innerHTML;
        }
      }
    }
    for (var i=0; i<xrefs.length; i++) {
      const xref = xrefs[i];
      tippyHover(xref, undefined, function(instance) {
        instance.disable();
        let url = xref.getAttribute('href');
        let hash = undefined; 
        if (url.startsWith('#')) {
          hash = url;
        } else {
          try { hash = new URL(url).hash; } catch {}
        }
        if (hash) {
          const id = hash.replace(/^#\/?/, "");
          const note = window.document.getElementById(id);
          if (note !== null) {
            try {
              const html = processXRef(id, note.cloneNode(true));
              instance.setContent(html);
            } finally {
              instance.enable();
              instance.show();
            }
          } else {
            // See if we can fetch this
            fetch(url.split('#')[0])
            .then(res => res.text())
            .then(html => {
              const parser = new DOMParser();
              const htmlDoc = parser.parseFromString(html, "text/html");
              const note = htmlDoc.getElementById(id);
              if (note !== null) {
                const html = processXRef(id, note);
                instance.setContent(html);
              } 
            }).finally(() => {
              instance.enable();
              instance.show();
            });
          }
        } else {
          // See if we can fetch a full url (with no hash to target)
          // This is a special case and we should probably do some content thinning / targeting
          fetch(url)
          .then(res => res.text())
          .then(html => {
            const parser = new DOMParser();
            const htmlDoc = parser.parseFromString(html, "text/html");
            const note = htmlDoc.querySelector('main.content');
            if (note !== null) {
              // This should only happen for chapter cross references
              // (since there is no id in the URL)
              // remove the first header
              if (note.children.length > 0 && note.children[0].tagName === "HEADER") {
                note.children[0].remove();
              }
              const html = processXRef(null, note);
              instance.setContent(html);
            } 
          }).finally(() => {
            instance.enable();
            instance.show();
          });
        }
      }, function(instance) {
      });
    }
        let selectedAnnoteEl;
        const selectorForAnnotation = ( cell, annotation) => {
          let cellAttr = 'data-code-cell="' + cell + '"';
          let lineAttr = 'data-code-annotation="' +  annotation + '"';
          const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
          return selector;
        }
        const selectCodeLines = (annoteEl) => {
          const doc = window.document;
          const targetCell = annoteEl.getAttribute("data-target-cell");
          const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
          const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
          const lines = annoteSpan.getAttribute("data-code-lines").split(",");
          const lineIds = lines.map((line) => {
            return targetCell + "-" + line;
          })
          let top = null;
          let height = null;
          let parent = null;
          if (lineIds.length > 0) {
              //compute the position of the single el (top and bottom and make a div)
              const el = window.document.getElementById(lineIds[0]);
              top = el.offsetTop;
              height = el.offsetHeight;
              parent = el.parentElement.parentElement;
            if (lineIds.length > 1) {
              const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
              const bottom = lastEl.offsetTop + lastEl.offsetHeight;
              height = bottom - top;
            }
            if (top !== null && height !== null && parent !== null) {
              // cook up a div (if necessary) and position it 
              let div = window.document.getElementById("code-annotation-line-highlight");
              if (div === null) {
                div = window.document.createElement("div");
                div.setAttribute("id", "code-annotation-line-highlight");
                div.style.position = 'absolute';
                parent.appendChild(div);
              }
              div.style.top = top - 2 + "px";
              div.style.height = height + 4 + "px";
              div.style.left = 0;
              let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
              if (gutterDiv === null) {
                gutterDiv = window.document.createElement("div");
                gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
                gutterDiv.style.position = 'absolute';
                const codeCell = window.document.getElementById(targetCell);
                const gutter = codeCell.querySelector('.code-annotation-gutter');
                gutter.appendChild(gutterDiv);
              }
              gutterDiv.style.top = top - 2 + "px";
              gutterDiv.style.height = height + 4 + "px";
            }
            selectedAnnoteEl = annoteEl;
          }
        };
        const unselectCodeLines = () => {
          const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
          elementsIds.forEach((elId) => {
            const div = window.document.getElementById(elId);
            if (div) {
              div.remove();
            }
          });
          selectedAnnoteEl = undefined;
        };
          // Handle positioning of the toggle
      window.addEventListener(
        "resize",
        throttle(() => {
          elRect = undefined;
          if (selectedAnnoteEl) {
            selectCodeLines(selectedAnnoteEl);
          }
        }, 10)
      );
      function throttle(fn, ms) {
      let throttle = false;
      let timer;
        return (...args) => {
          if(!throttle) { // first call gets through
              fn.apply(this, args);
              throttle = true;
          } else { // all the others get throttled
              if(timer) clearTimeout(timer); // cancel #2
              timer = setTimeout(() => {
                fn.apply(this, args);
                timer = throttle = false;
              }, ms);
          }
        };
      }
        // Attach click handler to the DT
        const annoteDls = window.document.querySelectorAll('dt[data-target-cell]');
        for (const annoteDlNode of annoteDls) {
          annoteDlNode.addEventListener('click', (event) => {
            const clickedEl = event.target;
            if (clickedEl !== selectedAnnoteEl) {
              unselectCodeLines();
              const activeEl = window.document.querySelector('dt[data-target-cell].code-annotation-active');
              if (activeEl) {
                activeEl.classList.remove('code-annotation-active');
              }
              selectCodeLines(clickedEl);
              clickedEl.classList.add('code-annotation-active');
            } else {
              // Unselect the line
              unselectCodeLines();
              clickedEl.classList.remove('code-annotation-active');
            }
          });
        }
    const findCites = (el) => {
      const parentEl = el.parentElement;
      if (parentEl) {
        const cites = parentEl.dataset.cites;
        if (cites) {
          return {
            el,
            cites: cites.split(' ')
          };
        } else {
          return findCites(el.parentElement)
        }
      } else {
        return undefined;
      }
    };
    var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
    for (var i=0; i<bibliorefs.length; i++) {
      const ref = bibliorefs[i];
      const citeInfo = findCites(ref);
      if (citeInfo) {
        tippyHover(citeInfo.el, function() {
          var popup = window.document.createElement('div');
          citeInfo.cites.forEach(function(cite) {
            var citeDiv = window.document.createElement('div');
            citeDiv.classList.add('hanging-indent');
            citeDiv.classList.add('csl-entry');
            var biblioDiv = window.document.getElementById('ref-' + cite);
            if (biblioDiv) {
              citeDiv.innerHTML = biblioDiv.innerHTML;
            }
            popup.appendChild(citeDiv);
          });
          return popup.innerHTML;
        });
      }
    }
  });
  </script>
</div> <!-- /content -->




</body></html>